<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<!--<meta content='width=450, maximum-scale=1.0, user-scalable=0' name='viewport'/> -->
	<meta charset="utf-8">
	<TITLE>Bombersudoku!</TITLE>
	<SCRIPT type="text/javascript" language="JavaScript" src="main.js"></SCRIPT>
	<SCRIPT type="text/javascript" language="JavaScript" src="user_io.js"></SCRIPT>
	<SCRIPT type="text/javascript" language="JavaScript" src="generate_field.js"></SCRIPT>
	<SCRIPT type="text/javascript" language="JavaScript" src="solver.js"></SCRIPT>
	<SCRIPT type="text/javascript" language="JavaScript" src="bomberman.js"></SCRIPT>
	<SCRIPT type="text/javascript" language="JavaScript" src="bomb.js"></SCRIPT>
	<SCRIPT type="text/javascript" language="JavaScript" src="achievements.js"></SCRIPT>
	<SCRIPT type="text/javascript" language="JavaScript" src="slider.js"></SCRIPT>
	<script src="http://vk.com/js/api/xd_connection.js?2"  type="text/javascript"></script>
	<link rel="stylesheet" type="text/css" href="range.css"/>
	<style type="text/css">
		.wallIEFixBackgroundSize {
			filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='images/wall.jpg', sizingMethod='scale');
			-ms-filter: "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='images/wall.jpg', sizingMethod='scale')";
		}
		.targetIEFixBackgroundSize {
			filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='images/target.png', sizingMethod='scale');
			-ms-filter: "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='images/target.png', sizingMethod='scale')";
		}
		.explosionIEFixBackgroundSize {
			filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='images/explosion.png', sizingMethod='scale');
			-ms-filter: "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='images/explosion.png', sizingMethod='scale')";
		}
	</style>
</HEAD>
<BODY onload="resize();" onresize="resize()" onkeypress="handleKey(event)" onkeydown="handleKey(event)">

<div id="popupOverlay" style='position: fixed; _position:absolute; top:0px; left:0px; width: 450px; height: 600px; background-color: lightgrey; z-index:10; opacity:0.5; filter: alpha(opacity=50); display:none' onclick="hidePopup()">
</div>

<div id="popup" style='position: fixed; _position:absolute; top:50%; left:50%; margin-top: -150px; margin-left: -125px; z-index:11; display:none;'>
<script type="text/javascript" language="JavaScript">
document.write('<table border = 1 style = "border:solid; border-color: #000000; background-color: #E0EEE0; border-radius:10px; font-size: 14pt">')
		for (var i = 0; i < 3; i++) {
			document.write('<tr align = "center">')
			for (var j = 0; j < 3; j++) {
				var digit = i*3 + j + 1
				document.write('<td style="border:solid 1px" height = "75" width = "75" onclick="enterDigit(' + digit + ')"><b>' + digit + '</b></td>')
			}
			document.write('</tr>')
		}
	document.write('<tr align = "center"><td style="border:solid 1px" height="75" onclick="enterDigit(0)"><b>Сброс</b></td><td style="border:solid 1px" height="75" colspan=2 onclick="hidePopup()"><b>Отмена</b></td></tr>')
document.write('</table>')
</script>
</div>

<div id="info" style='position: fixed; _position:absolute; z-index:12; display:none; width:200px; height:80px; top:50%; left:50%; margin-top: -40px; margin-left: -100px; border:5px solid #B4CDCD; background-color: #D1EEEE; border-radius:10px; text-align:center;line-height: 80px;'>
You win!
</div>
<div id="all" style = 'display:none; position: absolute; top:0px; left:50%; margin-left: -225px; width: 450px;'>
<br>
<table width="450">
<tr>
	<td width = '33%' align = "center">
		<input type="button" id="hint" style="width: 150px; height: 45px;" value="В главное меню" onClick="showMainMenu()">
	</td>
	<td width = '33%' align = "center">
		<span id="timer">00:00</span>
	</td>	
	<td width = '33%' align = "center">
		<input type="button" id="hint" style="width: 150px; height: 45px;" value="Подсказки" onClick="showHints()">
	</td>	
</tr>
</table>
<!--TODO: remove these test objects -->
<input type = 'button' value = 'Показать решение' onclick = 'showSolution()'><br>
Скорость: <input type="range" min="1" max="10" id="speedRange" oninput="setSpeed()" value="1"><span id = 'speedSpan'>0</span><br>
Мощность бомб: <input type="range" min="1" max="8" id="powerRange" oninput="setPower()" value="2"><span id = 'powerSpan'>0</span><br>
Таймер бомб: <input type="range" min="1000" max="10000" step = '100' id="timerRange" oninput="setTimer()" value="3000"><span id = 'timerSpan'>0</span><br>
Стен в награду: <input type="range" min="0" max="9" id="wallRange" oninput="setWallRange()" value="3"><span id = 'wallSpan'>3</span><br>
Ставить стены мышкой: <input type = 'checkbox' id = 'wallCheck' onchange = 'switchMouseWall()'><br>
&nbsp<input type = 'button' id = 'startStopButton' value = 'Стоп' onclick = 'switchStartStop()'>
<script type="text/javascript" language="JavaScript">
document.write('<table id = "mainTable" border = "1" height = "' + cellSize*10 + '" width = "' + cellSize*10 + '" style = "position: relative; font-size: 14pt">')
		init_data();
		var i,j
		for(i = 0; i < 9; i++) {
			document.write('<tr align = "center">')
			for(j = 0; j < 9; j++) {
				document.write('<td ')
				var text = ''
				if (j%3 == 0)
					text += 'border-left:2px solid #000000;'
				if (i%3 == 0)
					text += 'border-top:2px solid #000000;'
				if (j%3 == 2)
					text += "border-right:2px solid #000000;"
				if (i%3 == 2)
					text += "border-bottom:2px solid #000000;"
				document.write(' style = " background-size: 100% 100%; ' + text + '" height = "' + cellSize + '" width = "' + cellSize + '" id = td' + i+j + ' onClick="handleClick(this)"><b>' + data[i][j] + '</b></td>')
			}
			document.write('</tr>')
		}
document.write('</table><br><br>')
</script>
</div>
<div id="mainMenu" style = 'display:block; position: absolute; top:25px; left:50%; margin-left: -225px; width: 450px; height: 400px; background-color: rgba(255, 255, 255, 0.5); border-radius: 10px;'>
	<table width = "450">
		<tr align = "center">
			<td style = 'font-size: 18pt'>Bombersudoku <script type="text/javascript" language="JavaScript">document.write(version)</script></td>
		</tr>
		<tr align = "center">
			<td><br><input type = "button" style = "width: 330px; height: 75px;" value = "Новая игра" onclick = "startNewGame()"></td>
		</tr>
		<tr align = "center">
			<td><input type = "button" style = "width: 330px; height: 75px;" value = "Достижения" onclick = "showAchievements()"></td>
		</tr>
		<tr align = "center">
			<td><input type = "button" style = "width: 330px; height: 75px;" value = "Настройки" onclick = "showSettings()"></td>
		</tr>
		<tr align = "center">
			<td><input type = "button" style = "width: 330px; height: 75px;;" value = "Правила" onclick = "showRules()"></td>
		</tr>
		<tr align = "center">
			<td><input type = "button" style = "width: 330px; height: 75px;" value = "Об игре" onclick = "showAboutInfo()"></td>
		</tr>
	</table>
</div>
<script type="text/javascript">
	VK.init(function() {
		var info = document.location.search.substr(1).split("&")
		console.log(info)
		for (var i in info) {
			if(info[i].indexOf('viewer_id') != -1) {
				current_id = parseInt(info[i].split('=')[1])
				break
			}
		}
		console.log('success, user_id = ' + current_id)
		if (current_id == 0)
			vkInited = 0
		else
			vkInited = 1
		/*VK.api('storage.get', {key: 'time', user_id: current_id}, function(data) {
			console.log(data)
			if (data.response != '')
				console.log('Best time = ' + data.response)
		})*/

	}, function() {
		console.log('fail')
		vkInited = 0
	}, '5.33');
</script>
</BODY>
</HTML>
